# `partiql-lang-kotlin` compared to the PartiQL Specification

This document outlines the ways in which the `partiql-lang-kotlin` reference implementation conforms and diverges from
the [PartiQL specification](https://partiql.org/assets/PartiQL-Specification.pdf).
Also included are some features that are part of the Kotlin implementation but are not yet formally defined in the 
PartiQL spec.

Note: the list is only partially completed. Sections 6.2 onwards from the spec have yet to be compared with the Kotlin
implementation.

## Features defined in spec

| Spec section	              |Feature	|Implemented in `partiql-lang-kotlin`	| Notes	                                                                                                                                                                                                             |
|----------------------------|---	|---	|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 3.3	                       |Syntax improvement `SELECT` optionally written as last clause	|No	| 	                                                                                                                                                                                                                  |
| 4	                         |Tuple path navigation	|Yes	| `t.a`; tuple `t` and attribute `a` (identifier)	                                                                                                                                                                   |
| 4	                         |Array navigation	|Yes	| `a[i]`; array `a`, `i` is an expression that evaluates to an integer	                                                                                                                                              |
| 4	                         |Tuple navigation with array notation	|Yes	| `a[s]`; shorthand for `a.s` where `a` is a tuple, `s` is either a string literal or expression CAST to a string	                                                                                                   |
| 4	                         |Composition of naviagations	|Yes	| `r.no[1]`	                                                                                                                                                                                                         |
| 4	                         |Tuple naviagation in tuples w/ duplicate attributes	|Yes	| 	                                                                                                                                                                                                                  |
| 4.1	                       |Tuple path evaluation on wrongly typed data	|Partially^1	| Permissive mode behavior returns `MISSING` as defined in the spec. "STRICT" type-checking mode doesn't exist in Kotlin implementation	                                                                             |
| 4.2	                       |Array navigation evaluation on wrongly typed data	|Partially^1	| `[1, 2, 3][1.0]` evalutes to `MISSING` in permissive; errors in LEGACY	                                                                                                                                            |
| 4.3	                       |Wildcard steps	|Yes	| 	                                                                                                                                                                                                                  |
| 4.3	                       |Path expressions with wildcards	|Yes	| 	                                                                                                                                                                                                                  |
| 5.1	                       |Ranging over bags and arrays	|Yes	| `AS` and `AT` support; along with single `FROM` item	                                                                                                                                                              |
| 5.1.1	                     |Position variable on bags	|Partially^1	| Permissive mode behavior returns `MISSING` as defined in the spec. LEGACY mode should error but doesn't. Sample query: `SELECT * FROM <<1, 2, 3>> AS v AT p`	                                                      |
| 5.1.1	                     |Iteration over a scalar value	|Partially^1	| Permissive mode behavior returns `MISSING` as defined in the spec. LEGACY mode should error but doesn't. Sample query: `SELECT * FROM 1 AS v AT p` or `SELECT * FROM [{'a':0, 'b':0}, {'a':1, 'b': 1}][0].a AS x`	 |
| 5.1.1	                     |Iteration over a tuple value	|Partially^1	| Permissive mode behavior returns `MISSING` as defined in the spec. LEGACY mode should error but doesn't. Sample query: `SELECT * FROM {'a': 1} AS v AT p`	                                                         |
| 5.1.1	                     |Iteration over an absent value	|Paritally^1	| Permissive mode behavior returns `MISSING` as defined in the spec. LEGACY mode should error but doesn't. Sample query: `SELECT * FROM [{'a':0, 'b':0}, {'a':1, 'b': 1}][0].c AS x`	                                |
| 5.2	                       |Ranging over attribute-value pairs (unpivoting tuples)	|Yes	| 	                                                                                                                                                                                                                  |
| 5.2.1	                     |Mistyping cases (`UNPIVOT`)	|Partially^1	| Permissive mode has the correct equivalent query for non-tuples. LEGACY mode doesn't error	                                                                                                                        |
| 5.3	                       |Combining multiple `FROM` items with Comma, `CROSS JOIN`, or `JOIN`	|Yes	| 	                                                                                                                                                                                                                  |
| 5.4	                       |Combining multiple `FROM` Items with `LEFT JOIN`	|Yes	| 	                                                                                                                                                                                                                  |
| 5.5	                       |Combining multiple `FROM` items with `FULL JOIN`	|Parser only	| Supports parsing of `FULL JOIN` (and `RIGHT JOIN`) but is not yet implemented	in the evaluator                                                                                                                     |
| 5.6	                       |Expanding `JOIN` and `LEFT JOIN` with `ON`	|Partially	| Implementation requires `ON` clause since v0.2.0 https://github.com/partiql/partiql-lang-kotlin/releases/tag/v0.2.0-alpha	                                                                                         |
| 5.7	                       |SQL's `LATERAL`	|No	| 	                                                                                                                                                                                                                  |
| 6.1	                       |`SELECT VALUE` core clause	|Yes	| 	                                                                                                                                                                                                                  |
| 6.1.1	                     |Tuple constructors	|Yes	| 	                                                                                                                                                                                                                  |
| 6.1.1	                     |Tuple constructors -- treatment of mistyped attribute names	|Partially^1	| Permissive mode has correct behavior. LEGACY mode follows type-checking mode and gives an error	                                                                                                                   |
| 6.1.1	                     |Tuple constructors -- treament of duplicate attribute names	|Yes	| 	                                                                                                                                                                                                                  |
| 6.1.2	                     |Array constructors	|Yes	| 	                                                                                                                                                                                                                  |
| 6.1.3	                     |Bag constructors	|Yes	| 	                                                                                                                                                                                                                  |
| 6.1.4	                     |Treatment of `MISSING` in `SELECT VALUE` -- when constructing tuples	|Yes	| Note: example in the spec (example 18) needs to alias the `FROM` source. Should be: `SELECT VALUE {'a':v.a, 'b':v.b} FROM [{'a':1, 'b':1}, {'a':2}] AS v`	                                                         |
| 6.1.4	                     |Treatment of `MISSING` in `SELECT VALUE` -- when constructing arrays	|Yes	| Note: example in the spec (example 19) needs to alias the `FROM` source. Should be: `SELECT VALUE [v.a, v.b] FROM [{'a':1, 'b':1}, {'a':2}] AS v`	                                                                 |
| 6.1.4	                     |Treament of `MISSING` in `SELECT VALUE` -- when constructing bags	|Yes	| Note: examples in the spec (examples 20 and 21) need to alias the `FROM` source.	                                                                                                                                  |
| TODO: other spec sections	 |	|	| https://github.com/partiql/partiql-lang-kotlin/issues/610 	                                                                                                                                                        |
| 11.1	                      |`COLL_*` functions	|No	| https://github.com/partiql/partiql-lang-kotlin/issues/222	                                                                                                                                                         |
| 	                          |	|	| 	                                                                                                                                                                                                                  |

Caveats:

* ^1 `partiql-lang-kotlin` does not support “STRICT” type-checking mode. It does have a “LEGACY” mode which offers stricter type-checking support than “PERMISSIVE” mode

## Features defined in `partiql-lang-kotlin`

|Feature	| Notes	                                                                                                                                                                                                       |
|---	|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
|`LET` clause	| - Mentioned in section 3.3 (pg 11). Proposed spec change PR: https://github.com/partiql/partiql-spec/pull/21. `LET` semantics defined in `partiql-spec#15`: https://github.com/partiql/partiql-spec/issues/15	 |
|`DML` (`INSERT`, `SET`, `REMOVE`, `DELETE`)	| Parsed only. Defined informally; no mention in spec	                                                                                                                                                         |
|`DDL` (`CREATE TABLE`, `DROP TABLE`, `CREATE INDEX`, `DROP INDEX`)	| Parsed only. Defined informally; no mention in spec	                                                                                                                                                         |
|`EXEC`	| Stored procedure calls	                                                                                                                                                                                      |
|	| 	                                                                                                                                                                                                            |
