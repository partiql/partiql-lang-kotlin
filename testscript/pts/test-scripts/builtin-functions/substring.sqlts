/*
 * Copyright 2019 Amazon.com, Inc. or its affiliates.  All rights reserved.
 *
 * Licensed under the Apache License, Version 2.0 (the "License").
 *  You may not use this file except in compliance with the License.
 * A copy of the License is located at:
 *
 *      http://aws.amazon.com/apache2.0/
 *
 *  or in the "license" file accompanying this file. This file is distributed on an "AS IS" BASIS,
 *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the License for the specific
 *  language governing permissions and limitations under the License.
 */

// valid cases 2 arguments --------------------------------------------------------------------------------------------

for::{
    template: [
        test::{
            id: 'substring valid cases 2 arguments with FROM syntax',
            statement: "substring('${target}' FROM ${start})",
            expected: (success $result)
        },

        test::{
            id: 'substring valid cases 2 arguments',
            statement: "substring('${target}', ${start})",
            expected: (success $result)
        }
    ],

    variable_sets: [
        { target: "123456789", start: "0",  result: "123456789" },
        { target: "123456789", start: "1",  result: "123456789" },
        { target: "123456789", start: "2",  result: "23456789" },
        { target: "123456789", start: "-4", result: "123456789" },

        { target: "", start: "-1", result: "" },
        { target: "", start: "0",  result: "" },

        { target: "ğŸ˜ğŸ˜ğŸ˜¸ğŸ˜¸", start: "3", result: "ğŸ˜¸ğŸ˜¸" },
        { target: "è©±å®¶èº«åœ§è²»è°·æ–™æ‘èƒ½è¨ˆç¨é‡‘", start: "6", result: "è°·æ–™æ‘èƒ½è¨ˆç¨é‡‘" },
        { target: "ĞĞ‚ĞƒĞ„Ğ…Ğ†Ğ‡ĞˆĞ‰ĞŠĞ‹ĞŒĞĞĞĞĞ‘Ğ’Ğ“Ğ”Ğ•Ğ–Ğ—Ğ˜Ğ™ĞšĞ›ĞœĞĞĞŸĞ Ğ¡Ğ¢Ğ£Ğ¤Ğ¥Ğ¦Ğ§Ğ¨Ğ©ĞªĞ«Ğ¬Ğ­Ğ®Ğ¯Ğ°Ğ±Ğ²Ğ³Ğ´ĞµĞ¶Ğ·Ğ¸Ğ¹ĞºĞ»Ğ¼Ğ½Ğ¾Ğ¿Ñ€ÑÑ‚ÑƒÑ„Ñ…Ñ†Ñ‡ÑˆÑ‰ÑŠÑ‹ÑŒÑÑÑ", start: "40", result: "Ğ¨Ğ©ĞªĞ«Ğ¬Ğ­Ğ®Ğ¯Ğ°Ğ±Ğ²Ğ³Ğ´ĞµĞ¶Ğ·Ğ¸Ğ¹ĞºĞ»Ğ¼Ğ½Ğ¾Ğ¿Ñ€ÑÑ‚ÑƒÑ„Ñ…Ñ†Ñ‡ÑˆÑ‰ÑŠÑ‹ÑŒÑÑÑ" },
        { target: "( Í¡Â° ÍœÊ– Í¡Â°)â”¬â”€â”¬ãƒ( Âº _ Âºãƒ)", start: "16", result: "( Âº _ Âºãƒ)" },
        { target: "ğªğ®ğ¢ğœğ¤ ğ›ğ«ğ¨ğ°ğ§ ğŸğ¨ğ± ğ£ğ®ğ¦ğ©ğ¬ ğ¨ğ¯ğğ«", start: "17", result: "ğ£ğ®ğ¦ğ©ğ¬ ğ¨ğ¯ğğ«" },

        // there are hidden code-points for some emoji's, see http://unicode.org/reports/tr51/#def_emoji_modifier_sequence
        // U+1F469 U+1F3FD
        { target: "ğŸ‘©ğŸ½", start: "2", result: "ğŸ½" },
    ]
}

// valid cases 3 arguments --------------------------------------------------------------------------------------------
for::{
    template: [
        test::{
            id: 'substring valid cases 3 arguments using FROM syntax',
            statement: "substring('${target}' FROM ${start} FOR ${quantity})",
            expected: (success $result)
        },

        test::{
            id: 'substring valid cases 3 arguments',
            statement: "substring('${target}', ${start}, ${quantity})",
            expected: (success $result)
        }
    ],
    variable_sets: [
        { target: "123456789", start: "0",  quantity: "999", result: "123456789" },
        { target: "123456789", start: "0",  quantity: "2",   result: "1" },

        { target: "123456789", start: "1",  quantity: "999", result: "123456789" },
        { target: "123456789", start: "1",  quantity: "2",   result: "12" },

        { target: "123456789", start: "2",  quantity: "999", result: "23456789" },
        { target: "123456789", start: "2",  quantity: "3",   result: "234" },

        { target: "123456789", start: "-4", quantity: "999", result: "123456789" },
        { target: "123456789", start: "-4", quantity: "6",   result: "1" },

        { target: "",  start: "-1", quantity: "999", result: "" },
        { target: "",  start: "0",  quantity: "999", result: "" },
        { target: "1", start: "-4", quantity: "1",   result: "" },
        { target: "1", start: "-4", quantity: "0",   result: "" },
        { target: "1", start: "1", quantity: "0",   result: "" },
        { target: "1", start: "0", quantity: "0",   result: "" },

        { target: "ğŸ˜ğŸ˜ğŸ˜¸ğŸ˜¸", start: "3", quantity: "999", result: "ğŸ˜¸ğŸ˜¸" },
        { target: "ğŸ˜ğŸ˜ğŸ˜¸ğŸ˜¸", start: "3", quantity: "1",   result: "ğŸ˜¸" },

        { target: "è©±å®¶èº«åœ§è²»è°·æ–™æ‘èƒ½è¨ˆç¨é‡‘", start: "6", quantity: "999", result: "è°·æ–™æ‘èƒ½è¨ˆç¨é‡‘" },
        { target: "è©±å®¶èº«åœ§è²»è°·æ–™æ‘èƒ½è¨ˆç¨é‡‘", start: "6", quantity: "2",   result: "è°·æ–™" },

        { target: "ĞĞ‚ĞƒĞ„Ğ…Ğ†Ğ‡ĞˆĞ‰ĞŠĞ‹ĞŒĞĞĞĞĞ‘Ğ’Ğ“Ğ”Ğ•Ğ–Ğ—Ğ˜Ğ™ĞšĞ›ĞœĞĞĞŸĞ Ğ¡Ğ¢Ğ£Ğ¤Ğ¥Ğ¦Ğ§Ğ¨Ğ©ĞªĞ«Ğ¬Ğ­Ğ®Ğ¯Ğ°Ğ±Ğ²Ğ³Ğ´ĞµĞ¶Ğ·Ğ¸Ğ¹ĞºĞ»Ğ¼Ğ½Ğ¾Ğ¿Ñ€ÑÑ‚ÑƒÑ„Ñ…Ñ†Ñ‡ÑˆÑ‰ÑŠÑ‹ÑŒÑÑÑ", start: "40", quantity: "999", result: "Ğ¨Ğ©ĞªĞ«Ğ¬Ğ­Ğ®Ğ¯Ğ°Ğ±Ğ²Ğ³Ğ´ĞµĞ¶Ğ·Ğ¸Ğ¹ĞºĞ»Ğ¼Ğ½Ğ¾Ğ¿Ñ€ÑÑ‚ÑƒÑ„Ñ…Ñ†Ñ‡ÑˆÑ‰ÑŠÑ‹ÑŒÑÑÑ" },
        { target: "ĞĞ‚ĞƒĞ„Ğ…Ğ†Ğ‡ĞˆĞ‰ĞŠĞ‹ĞŒĞĞĞĞĞ‘Ğ’Ğ“Ğ”Ğ•Ğ–Ğ—Ğ˜Ğ™ĞšĞ›ĞœĞĞĞŸĞ Ğ¡Ğ¢Ğ£Ğ¤Ğ¥Ğ¦Ğ§Ğ¨Ğ©ĞªĞ«Ğ¬Ğ­Ğ®Ğ¯Ğ°Ğ±Ğ²Ğ³Ğ´ĞµĞ¶Ğ·Ğ¸Ğ¹ĞºĞ»Ğ¼Ğ½Ğ¾Ğ¿Ñ€ÑÑ‚ÑƒÑ„Ñ…Ñ†Ñ‡ÑˆÑ‰ÑŠÑ‹ÑŒÑÑÑ", start: "40", quantity: "4",   result: "Ğ¨Ğ©ĞªĞ«" },

        { target: "( Í¡Â° ÍœÊ– Í¡Â°)â”¬â”€â”¬ãƒ( Âº _ Âºãƒ)", start: "16", quantity: "999", result: "( Âº _ Âºãƒ)" },
        { target: "( Í¡Â° ÍœÊ– Í¡Â°)â”¬â”€â”¬ãƒ( Âº _ Âºãƒ)", start: "18", quantity: "5", result: "Âº _ Âº" },

        { target: "ğªğ®ğ¢ğœğ¤ ğ›ğ«ğ¨ğ°ğ§ ğŸğ¨ğ± ğ£ğ®ğ¦ğ©ğ¬ ğ¨ğ¯ğğ«", start: "17", quantity: "999", result: "ğ£ğ®ğ¦ğ©ğ¬ ğ¨ğ¯ğğ«" },
        { target: "ğªğ®ğ¢ğœğ¤ ğ›ğ«ğ¨ğ°ğ§ ğŸğ¨ğ± ğ£ğ®ğ¦ğ©ğ¬ ğ¨ğ¯ğğ«", start: "17", quantity: "5", result: "ğ£ğ®ğ¦ğ©ğ¬" },

        // there are hidden code-points for some emoji's, see http://unicode.org/reports/tr51/#def_emoji_modifier_sequence
        // U+1F469 U+1F3FD
        { target: "ğŸ‘©ğŸ½", start: "1", quantity: "1", result: "ğŸ‘©" },
    ]
}

// null propagation 2 args -----------------------------------------------------------------------------------------
for::{
    template: [
        test::{
            id: 'substring null and missing propagation 2 arguments',
            statement: "substring(${target}, ${start_pos})",
            expected: (success null)
        }
    ],
    variable_sets: [
        { target: "null",    start_pos: "1",       },
        { target: "''",      start_pos: "null",    },
        { target: "null",    start_pos: "null",    },

        { target: "missing", start_pos: "1",       },
        { target: "''",      start_pos: "missing", },
        { target: "missing", start_pos: "missing", },

        { target: "null",    start_pos: "missing", },
        { target: "missing", start_pos: "null",    },
    ]
}

// null propagation 3 args -----------------------------------------------------------------------------------------
for::{
    template: [
        test::{
            id: 'substring null and missing propagation 3 arguments',
            statement: "substring(${target}, ${start_pos}, ${quantity})",
            expected: (success null)
        }
    ],
    variable_sets: [
        { target: "null", start_pos: "1",       quantity: "1",       },
        { target: "null", start_pos: "1",       quantity: "null",    },
        { target: "null", start_pos: "1",       quantity: "missing", },
        
        { target: "null", start_pos: "null",    quantity: "1",       },
        { target: "null", start_pos: "null",    quantity: "null",    },
        { target: "null", start_pos: "null",    quantity: "missing", },
        
        { target: "null", start_pos: "missing", quantity: "1",       },
        { target: "null", start_pos: "missing", quantity: "null",    },
        { target: "null", start_pos: "missing", quantity: "missing", },

        { target: "missing", start_pos: "1",       quantity: "1",       },
        { target: "missing", start_pos: "1",       quantity: "null",    },
        { target: "missing", start_pos: "1",       quantity: "missing", },
        
        { target: "missing", start_pos: "null",    quantity: "1",       },
        { target: "missing", start_pos: "null",    quantity: "null",    },
        { target: "missing", start_pos: "null",    quantity: "missing", },
        
        { target: "missing", start_pos: "missing", quantity: "1",       },
        { target: "missing", start_pos: "missing", quantity: "null",    },
        { target: "missing", start_pos: "missing", quantity: "missing", },
     
        { target: "''",   start_pos: "1",       quantity: "null",    },
        { target: "''",   start_pos: "1",       quantity: "missing", },
        
        { target: "''",   start_pos: "null",    quantity: "1",       },
        { target: "''",   start_pos: "null",    quantity: "null",    },
        { target: "''",   start_pos: "null",    quantity: "missing", },
        
        { target: "''",   start_pos: "missing", quantity: "1",       },
        { target: "''",   start_pos: "missing", quantity: "null",    },
        { target: "''",   start_pos: "missing", quantity: "missing", },
    ]
}

// wrong number of arguments --------------------------------------------------------------------------------------
for::{
    template: [
        test::{
            id: 'substring wrong number of arguments',
            statement: $sql,
            expected: (error)
        }
    ],
    variable_sets: [
        { sql: "substring('')",           },
        { sql: "substring('', 1, 1, 1)",  },
        { sql: "substring('', 1, 1, '')", },
    ]
}

// wrong type of arguments ---------------------------------------------------------------------------------------
for::{
    template: [
        test::{
            id: 'substring wrong type of arguments',
            statement: $sql,
            expected: (error)
        }
    ],
    variable_sets: [
        { sql: "substring('', `{}`)" },
        { sql: "substring(1, 1)" },

        { sql: "substring(1, 1, 1)" },
        { sql: "substring('', [], 1)" },
        { sql: "substring('', 1.1, 1)" },
        { sql: "substring('', 1e1, 1)" },
        { sql: "substring('', 1, 1.1)" },
    ]
}

// invalid arguments ---------------------------------------------------------------------------------------
test::{
    id: 'substring invalid quantity',
    statement: "substring('1', 4, -11)",
    expected: (error)
}
