/*
 * Copyright 2019 Amazon.com, Inc. or its affiliates.  All rights reserved.
 *
 * Licensed under the Apache License, Version 2.0 (the "License").
 *  You may not use this file except in compliance with the License.
 * A copy of the License is located at:
 *
 *      http://aws.amazon.com/apache2.0/
 *
 *  or in the "license" file accompanying this file. This file is distributed on an "AS IS" BASIS,
 *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the License for the specific
 *  language governing permissions and limitations under the License.
 */


for::{
    template:[
        test::{
             name: "concatenation with non-nulls" ,
             sql: "{ `concatenated_literals`: '${left}' || '${right}', `concatenated_variables`:  env_left || env_right }",
             environment: { env_left: $left, env_right: $right },
             expected: result::{ concatenated_literals: $result, concatenated_variables: $result }
          },
    ],
    variableSets: [
        { left: "",         right:"",           result: ""              },
        { left: "left",     right:"",           result: "left"          },
        { left: "",         right:"right",      result: "right"         },
        { left: "a",        right:"b",          result: "ab"            },
        { left: "hello",    right:"world",      result: "helloworld"    },

        // right is a unicode combining diacritical mark, result appears a single character even though its actually 2
        { left: "o",        right: "\u0300",    result: "oÌ€"             },

        {
            left: "è©±å®¶èº«åœ§è²»è°·",
            right:"æ–™æ‘èƒ½è¨ˆç¨é‡‘",
            result: "è©±å®¶èº«åœ§è²»è°·æ–™æ‘èƒ½è¨ˆç¨é‡‘"
        },
        {
            left: "ĞĞ‚ĞƒĞ„Ğ…Ğ†Ğ‡ĞˆĞ‰ĞŠĞ‹ĞŒĞĞĞĞĞ‘Ğ’Ğ“Ğ”Ğ•Ğ–Ğ—Ğ˜Ğ™ĞšĞ›ĞœĞĞĞŸĞ Ğ¡",
            right:"Ğ¢Ğ£Ğ¤Ğ¥Ğ¦Ğ§Ğ¨Ğ©ĞªĞ«Ğ¬Ğ­Ğ®Ğ¯Ğ°Ğ±Ğ²Ğ³Ğ´ĞµĞ¶Ğ·Ğ¸Ğ¹ĞºĞ»Ğ¼Ğ½Ğ¾Ğ¿Ñ€ÑÑ‚ÑƒÑ„Ñ…Ñ†Ñ‡ÑˆÑ‰ÑŠÑ‹ÑŒÑÑÑ",
            result: "ĞĞ‚ĞƒĞ„Ğ…Ğ†Ğ‡ĞˆĞ‰ĞŠĞ‹ĞŒĞĞĞĞĞ‘Ğ’Ğ“Ğ”Ğ•Ğ–Ğ—Ğ˜Ğ™ĞšĞ›ĞœĞĞĞŸĞ Ğ¡Ğ¢Ğ£Ğ¤Ğ¥Ğ¦Ğ§Ğ¨Ğ©ĞªĞ«Ğ¬Ğ­Ğ®Ğ¯Ğ°Ğ±Ğ²Ğ³Ğ´ĞµĞ¶Ğ·Ğ¸Ğ¹ĞºĞ»Ğ¼Ğ½Ğ¾Ğ¿Ñ€ÑÑ‚ÑƒÑ„Ñ…Ñ†Ñ‡ÑˆÑ‰ÑŠÑ‹ÑŒÑÑÑ"
        },
        {
            left: "ğªğ®ğ¢ğœğ¤ ğ›ğ«ğ¨ğ°ğ§ ğŸğ¨ğ± ",
            right:"ğ£ğ®ğ¦ğ©ğ¬ ğ¨ğ¯ğğ«",
            result: "ğªğ®ğ¢ğœğ¤ ğ›ğ«ğ¨ğ°ğ§ ğŸğ¨ğ± ğ£ğ®ğ¦ğ©ğ¬ ğ¨ğ¯ğğ«"
        },
        {
            left: "( Í¡Â° ÍœÊ– Í¡Â°)â”¬â”€â”¬ãƒ",
            right:"( Âº _ Âºãƒ)",
            result: "( Í¡Â° ÍœÊ– Í¡Â°)â”¬â”€â”¬ãƒ( Âº _ Âºãƒ)"
        },
        {
            left: "ğŸ˜",
            right:"ğŸ˜",
            result: "ğŸ˜ğŸ˜"
        },
        {
            left: "ğŸ’©ğŸ’©",
            right:"ğŸ’©ğŸ’©",
            result: "ğŸ’©ğŸ’©ğŸ’©ğŸ’©"
        },
    ]
}

for::{
    template:[
        test::{
             name: "concatenation with null values" ,
             sql: "${left} || ${right}",
             expected: $expected
          },
    ],
    variableSets: [
        { left: "NULL",         right:"NULL",       expected: result::null },
        { left: "MISSING",      right:"MISSING",    expected: result::null },

        { left: "''",          right:"NULL",        expected: result::null },
        { left: "NULL",         right:"''",         expected: result::null },

        { left: "''",          right:"MISSING",     expected: result::null },
        { left: "MISSING",         right:"''",      expected: result::null },

        { left: "'a'",          right:"NULL",       expected: result::null },
        { left: "NULL",         right:"'b'",        expected: result::null },

        { left: "'a'",          right:"MISSING",    expected: result::null },
        { left: "MISSING",      right:"'b'",        expected: result::null },
    ]
}

for::{
    template:[
        test::{
            name: "concatenation with non-string values" ,
            sql: "${left} || ${right}",
            expected: error::{
                code: "null",   // should not be null: https://github.com/partiql/partiql-lang-kotlin/issues/27
                properties: {
                    LINE_NUMBER:1,
                    COLUMN_NUMBER:$expected_column
                }
            }
          },
    ],
    variableSets: [
        { left: "'a'",      right:"1",      expected_column: 5 },
        { left: "1",        right:"'a'",    expected_column: 3 },

        { left: "'a'",      right:"true",   expected_column: 5 },
        { left: "true",     right:"'a'",    expected_column: 6 },

        { left: "'a'",      right:"1.1",    expected_column: 5 },
        { left: "1.1",      right:"'a'",    expected_column: 5 },

        { left: "1",        right:"1",      expected_column: 3 },
        { left: "false",    right:"true",   expected_column: 7 },
        { left: "1.2",      right:"1.1",    expected_column: 5 },
    ]
}