/*
 * Copyright 2019 Amazon.com, Inc. or its affiliates.  All rights reserved.
 *
 * Licensed under the Apache License, Version 2.0 (the "License").
 *  You may not use this file except in compliance with the License.
 * A copy of the License is located at:
 *
 *      http://aws.amazon.com/apache2.0/
 *
 *  or in the "license" file accompanying this file. This file is distributed on an "AS IS" BASIS,
 *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the License for the specific
 *  language governing permissions and limitations under the License.
 */

// valid cases ----------------------------------------------------------------------------------------------------
for::{
    template: [
        test::{
            name: "char_length valid cases",
            sql: "char_length('${in}')",
            expected: $result
        },

        test::{
            name: "character_length valid cases",
            sql: "character_length('${in}')",
            expected: $result
        }
    ],

    variableSets: [
        { in: "", result: result::0 },
        { in: "a", result: result::1 },
        { in: "123456789", result: result::9 },
        { in: "aviÃ£o", result: result::5 },  // non ASCII
        { in: "eà «",                     result: result::2 },  // eà «' is two codepoints: the letter 'e' and combining character U+032B
        { in: "ğŸ˜ğŸ˜ğŸ˜¸ğŸ˜¸", result: result::4 },  // non-BMP unicode characters
        { in: "è©±å®¶èº«åœ§è²»è°·æ–™æ‘èƒ½è¨ˆç¨é‡‘", result: result::12 }, // other alphabets

        // from https://github.com/minimaxir/big-list-of-naughty-strings.
        // Not all were used as some are context specific, e.g. XSS attacks
        { in: "undefined",      result: result::9 },
        { in: "undef",          result: result::5 },
        { in: "null",           result: result::4 },
        { in: "NULL",           result: result::4 },
        { in: "(null)",         result: result::6 },
        { in: "nil",            result: result::3 },
        { in: "NIL",            result: result::3 },
        { in: "true",           result: result::4 },
        { in: "false",          result: result::5 },
        { in: "True",           result: result::4 },
        { in: "False",          result: result::5 },
        { in: "TRUE",           result: result::4 },
        { in: "FALSE",          result: result::5 },
        { in: "None",           result: result::4 },
        { in: "hasOwnProperty", result: result::14 },

        { in: "999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999", result: result::96 },
        { in: "123456789012345678901234567890123456789", result: result::39 },
        { in: "0",                       result: result::1 },
        { in: "1",                       result: result::1 },
        { in: "1.00",                    result: result::4 },
        { in: "$1.00",                   result: result::5 },
        { in: "1/2",                     result: result::3 },
        { in: "1E2",                     result: result::3 },
        { in: "1E02",                    result: result::4 },
        { in: "1E+02",                   result: result::5 },
        { in: "-1",                      result: result::2 },
        { in: "-1.00",                   result: result::5 },
        { in: "-$1.00",                  result: result::6 },
        { in: "-1/2",                    result: result::4 },
        { in: "-1E2",                    result: result::4 },
        { in: "-1E02",                   result: result::5 },
        { in: "-1E+02",                  result: result::6 },
        { in: "1/0",                     result: result::3 },
        { in: "0/0",                     result: result::3 },
        { in: "-2147483648/-1",          result: result::14 },
        { in: "-9223372036854775808/-1", result: result::23 },
        { in: "-0",                      result: result::2 },
        { in: "-0.0",                    result: result::4 },
        { in: "+0",                      result: result::2 },
        { in: "+0.0",                    result: result::4 },
        { in: "0.00",                    result: result::4 },
        { in: "0..0",                    result: result::4 },
        { in: ".",                       result: result::1 },
        { in: "0.0.0",                   result: result::5 },
        { in: "0,00",                    result: result::4 },
        { in: "0,,0",                    result: result::4 },
        { in: ",",                       result: result::1 },
        { in: "0,0,0",                   result: result::5 },
        { in: "0.0/0",                   result: result::5 },
        { in: "1.0/0.0",                 result: result::7 },
        { in: "0.0/0.0",                 result: result::7 },
        { in: "1,0/0,0",                 result: result::7 },
        { in: "0,0/0,0",                 result: result::7 },
        { in: "--1",                     result: result::3 },
        { in: "-",                       result: result::1 },
        { in: "-.",                      result: result::2 },
        { in: "-,",                      result: result::2 },
        { in: "NaN",                     result: result::3 },
        { in: "Infinity",                result: result::8 },
        { in: "-Infinity",               result: result::9 },
        { in: "INF",                     result: result::3 },
        { in: "1#INF",                   result: result::5 },
        { in: "-1#IND",                  result: result::6 },
        { in: "1#QNAN",                  result: result::6 },
        { in: "1#SNAN",                  result: result::6 },
        { in: "1#IND",                   result: result::5 },
        { in: "0x0",                     result: result::3 },
        { in: "0xffffffff",              result: result::10 },
        { in: "0xffffffffffffffff",      result: result::18 },
        { in: "0xabad1dea",              result: result::10 },
        { in: "1,000.00",                result: result::8 },
        { in: "1 000.00",                result: result::8 },

        { in: "1,000,000.00",            result: result::12 },
        { in: "1 000 000.00",            result: result::12 },
        { in: "1.000,00",                result: result::8 },
        { in: "1 000,00",                result: result::8 },
        { in: "1.000.000,00",            result: result::12 },
        { in: "1 000 000,00",            result: result::12 },
        { in: "01000",                   result: result::5 },
        { in: "08",                      result: result::2 },
        { in: "09",                      result: result::2 },
        { in: "2.2250738585072011e-308", result: result::23 },

        { in: "ĞĞ‚ĞƒĞ„Ğ…Ğ†Ğ‡ĞˆĞ‰ĞŠĞ‹ĞŒĞĞĞĞĞ‘Ğ’Ğ“Ğ”Ğ•Ğ–Ğ—Ğ˜Ğ™ĞšĞ›ĞœĞĞĞŸĞ Ğ¡Ğ¢Ğ£Ğ¤Ğ¥Ğ¦Ğ§Ğ¨Ğ©ĞªĞ«Ğ¬Ğ­Ğ®Ğ¯Ğ°Ğ±Ğ²Ğ³Ğ´ĞµĞ¶Ğ·Ğ¸Ğ¹ĞºĞ»Ğ¼Ğ½Ğ¾Ğ¿Ñ€ÑÑ‚ÑƒÑ„Ñ…Ñ†Ñ‡ÑˆÑ‰ÑŠÑ‹ÑŒÑÑÑ", result: result::79 },
        { in: '''<>?:"{}|_+''', result: result::10 },
        { in: "!@#$%^&*()`~", result: result::12 },
        { in: "Î©â‰ˆÃ§âˆšâˆ«ËœÂµâ‰¤â‰¥Ã·", result: result::10 },
        { in: "Ã¥ÃŸâˆ‚Æ’Â©Ë™âˆ†ËšÂ¬â€¦Ã¦", result: result::11 },
        { in: "Å“âˆ‘Â´Â®â€ Â¥Â¨Ë†Ã¸Ï€â€œâ€˜", result: result::12 },
        { in: "Â¡â„¢Â£Â¢âˆÂ§Â¶â€¢ÂªÂºâ€“â‰ ", result: result::12 },
        { in: "Â¸Ë›Ã‡â—ŠÄ±ËœÃ‚Â¯Ë˜Â¿", result: result::10 },
        { in: "Ã…ÃÃÃËÃ“Ã”ï£¿Ã’ÃšÃ†â˜ƒ", result: result::12 },
        { in: "Å’â€Â´â€°Ë‡ÃÂ¨Ë†Ã˜âˆâ€â€™", result: result::12 },
        { in: "`â„â‚¬â€¹â€ºï¬ï¬‚â€¡Â°Â·â€šâ€”Â±", result: result::13 },
        { in: "â…›â…œâ…â…", result: result::4 },
        { in: "Ù Ù¡Ù¢Ù£Ù¤Ù¥Ù¦Ù§Ù¨Ù©", result: result::10 },
        { in: "ç”°ä¸­ã•ã‚“ã«ã‚ã’ã¦ä¸‹ã•ã„", result: result::11 },
        { in: "ãƒ‘ãƒ¼ãƒ†ã‚£ãƒ¼ã¸è¡Œã‹ãªã„ã‹", result: result::11 },
        { in: "å’Œè£½æ¼¢èª", result: result::4 },
        { in: "éƒ¨è½æ ¼", result: result::3 },
        { in: "ì‚¬íšŒê³¼í•™ì› ì–´í•™ì—°êµ¬ì†Œ", result: result::11 },
        { in: "ì°¦ì°¨ë¥¼ íƒ€ê³  ì˜¨ í²ì‹œë§¨ê³¼ ì‘›ë‹¤ë¦¬ ë˜ ë°©ê°í•˜", result: result::22 },
        { in: "ç¤¾æœƒç§‘å­¸é™¢èªå­¸ç ”ç©¶æ‰€", result: result::10 },
        { in: "ìš¸ë€ë°”í† ë¥´", result: result::5 },
        { in: "ğ œğ œ±ğ ¹ğ ±“ğ ±¸ğ ²–ğ ³", result: result::7 },
        { in: "Èº", result: result::1 },
        { in: "È¾", result: result::1 },

        { in: "ãƒ½à¼¼àºˆÙ„Íœàºˆà¼½ï¾‰ ãƒ½à¼¼àºˆÙ„Íœàºˆà¼½ï¾‰", result: result::17 },
        { in: "(ï½¡â—• âˆ€ â—•ï½¡)", result: result::9 },
        { in: "ï½€ï½¨(Â´âˆ€ï½€âˆ©", result: result::7 },
        { in: "__ï¾›(,_,*)", result: result::9 },
        { in: "ãƒ»(ï¿£âˆ€ï¿£)ãƒ»:*:", result: result::10 },
        { in: "ï¾Ÿï½¥âœ¿ãƒ¾â•²(ï½¡â—•â€¿â—•ï½¡)â•±âœ¿ï½¥ï¾Ÿ", result: result::16 },
        { in: ",ã€‚ãƒ»:*:ãƒ»ã‚œâ€™( â˜» Ï‰ â˜» )ã€‚ãƒ»:*:ãƒ»ã‚œâ€™", result: result::26 },
        { in: "(â•¯Â°â–¡Â°ï¼‰â•¯ï¸µ â”»â”â”»)", result: result::13 },
        { in: "(ï¾‰à²¥ç›Šà²¥ï¼‰ï¾‰ï»¿ â”»â”â”»", result: result::12 },
        { in: "â”¬â”€â”¬ãƒ( Âº _ Âºãƒ)", result: result::13 },
        { in: "( Í¡Â° ÍœÊ– Í¡Â°)", result: result::11 },

        { in: "ğŸ˜", result: result::1 },

        // there are hidden code-points for some emoji's, see http://unicode.org/reports/tr51/#def_emoji_modifier_sequence
        // since char_length counts UTF-8 code points the results below are correct, just not obviously so :)

        // U+1F469 U+1F3FD
        { in: "ğŸ‘©ğŸ½", result: result::2 },

        // U+1F469 U+1F47E U+0020 U+1F647 U+0020 U+1F481 U+0020 U+1F645 U+0020 U+1F646 U+0020 U+1F64B U+0020 U+1F64E U+0020 U+1F64D
        { in: "ğŸ‘¾ ğŸ™‡ ğŸ’ ğŸ™… ğŸ™† ğŸ™‹ ğŸ™ ğŸ™", result: result::15 },

        // U+1F435 U+0020 U+1F648 U+0020 U+1F649 U+0020 U+1F64A
        { in: "ğŸµ ğŸ™ˆ ğŸ™‰ ğŸ™Š", result: result::7 },

        // U+2764 U+FE0F U+0020 U+1F494 U+0020 U+1F48C U+0020 U+1F495 U+0020 U+1F49E U+0020 U+1F493 U+0020 U+1F497 U+0020 U+1F496 U+0020 U+1F498 U+0020 U+1F49D U+0020 U+1F49F U+0020 U+1F49C U+0020 U+1F49B U+0020 U+1F49A U+0020 U+1F499
        { in: "â¤ï¸ ğŸ’” ğŸ’Œ ğŸ’• ğŸ’ ğŸ’“ ğŸ’— ğŸ’– ğŸ’˜ ğŸ’ ğŸ’Ÿ ğŸ’œ ğŸ’› ğŸ’š ğŸ’™", result: result::30 },

        // U+270B U+1F3FF U+0020 U+1F4AA U+1F3FF U+0020 U+1F450 U+1F3FF U+0020 U+1F64C U+1F3FF U+0020 U+1F44F U+1F3FF U+0020 U+1F64F U+1F3FF
        { in: "âœ‹ğŸ¿ ğŸ’ªğŸ¿ ğŸ‘ğŸ¿ ğŸ™ŒğŸ¿ ğŸ‘ğŸ¿ ğŸ™ğŸ¿", result: result::17 },

        //  U+2764 U+270B U+1F3FF U+0020 U+1F4AA U+1F3FF U+1F6BE U+0020 U+1F192 U+0020 U+1F193 U+0020 U+1F195 U+0020 U+1F196 U+0020 U+1F197 U+0020 U+1F199 U+0020 U+1F3E7
        { in: "ğŸš¾ ğŸ†’ ğŸ†“ ğŸ†• ğŸ†– ğŸ†— ğŸ†™ ğŸ§", result: result::15 },

        // U+0030 U+FE0F U+20E3 U+0020 U+0031 U+FE0F U+20E3 U+0020 U+0032 U+FE0F U+20E3 U+0020 U+0033 U+FE0F U+20E3 U+0020 U+0034 U+FE0F U+20E3 U+0020 U+0035 U+FE0F U+20E3 U+0020 U+0036 U+FE0F U+20E3 U+0020 U+0037 U+FE0F U+20E3 U+0020 U+0038 U+FE0F U+20E3 U+0020 U+0039 U+FE0F U+20E3 U+0020 U+1F51F
        { in: "0ï¸âƒ£ 1ï¸âƒ£ 2ï¸âƒ£ 3ï¸âƒ£ 4ï¸âƒ£ 5ï¸âƒ£ 6ï¸âƒ£ 7ï¸âƒ£ 8ï¸âƒ£ 9ï¸âƒ£ ğŸ”Ÿ", result: result::41 },

        // U+1F1FA U+1F1F8 U+1F1F7 U+1F1FA U+1F1F8 U+0020 U+1F1E6 U+1F1EB U+1F1E6 U+1F1F2 U+1F1F8
        { in: "ğŸ‡ºğŸ‡¸ğŸ‡·ğŸ‡ºğŸ‡¸ ğŸ‡¦ğŸ‡«ğŸ‡¦ğŸ‡²ğŸ‡¸", result: result::11 },

        // U+1F1FA U+1F1F8 U+1F1F7 U+1F1FA U+1F1F8 U+1F1E6 U+1F1EB U+1F1E6 U+1F1F2
        { in: "ğŸ‡ºğŸ‡¸ğŸ‡·ğŸ‡ºğŸ‡¸ğŸ‡¦ğŸ‡«ğŸ‡¦ğŸ‡²", result: result::9 },

        // U+1F1FA U+1F1F8 U+1F1F7 U+1F1FA U+1F1F8 U+1F1E6
        { in: "ğŸ‡ºğŸ‡¸ğŸ‡·ğŸ‡ºğŸ‡¸ğŸ‡¦", result: result::6 },

        { in: "ï¼´ï½ˆï½… ï½‘ï½•ï½‰ï½ƒï½‹ ï½‚ï½’ï½ï½—ï½ ï½†ï½ï½˜ ï½Šï½•ï½ï½ï½“ ï½ï½–ï½…ï½’ ï½”ï½ˆï½… ï½Œï½ï½šï½™ ï½„ï½ï½‡", result: result::43 },
        { in: "ğ“ğ¡ğ ğªğ®ğ¢ğœğ¤ ğ›ğ«ğ¨ğ°ğ§ ğŸğ¨ğ± ğ£ğ®ğ¦ğ©ğ¬ ğ¨ğ¯ğğ« ğ­ğ¡ğ ğ¥ğšğ³ğ² ğğ¨ğ ", result: result::43 },
        { in: "ğ•¿ğ–ğ–Š ğ––ğ–šğ–ğ–ˆğ– ğ–‡ğ–—ğ–”ğ–œğ–“ ğ–‹ğ–”ğ– ğ–ğ–šğ–’ğ–•ğ–˜ ğ–”ğ–›ğ–Šğ–— ğ–™ğ–ğ–Š ğ–‘ğ–†ğ–Ÿğ– ğ–‰ğ–”ğ–Œ", result: result::43 },
        { in: "ğ‘»ğ’‰ğ’† ğ’’ğ’–ğ’Šğ’„ğ’Œ ğ’ƒğ’“ğ’ğ’˜ğ’ ğ’‡ğ’ğ’™ ğ’‹ğ’–ğ’ğ’‘ğ’” ğ’ğ’—ğ’†ğ’“ ğ’•ğ’‰ğ’† ğ’ğ’‚ğ’›ğ’š ğ’…ğ’ğ’ˆ", result: result::43 },
        { in: "ğ“£ğ“±ğ“® ğ“ºğ“¾ğ“²ğ“¬ğ“´ ğ“«ğ“»ğ“¸ğ”€ğ“· ğ“¯ğ“¸ğ” ğ“³ğ“¾ğ“¶ğ“¹ğ“¼ ğ“¸ğ“¿ğ“®ğ“» ğ“½ğ“±ğ“® ğ“µğ“ªğ”ƒğ”‚ ğ“­ğ“¸ğ“°", result: result::43 },
        { in: "ğ•‹ğ•™ğ•– ğ•¢ğ•¦ğ•šğ•”ğ•œ ğ•“ğ•£ğ• ğ•¨ğ•Ÿ ğ•—ğ• ğ•© ğ•›ğ•¦ğ•ğ•¡ğ•¤ ğ• ğ•§ğ•–ğ•£ ğ•¥ğ•™ğ•– ğ•ğ•’ğ•«ğ•ª ğ••ğ• ğ•˜", result: result::43 },
        { in: "ğšƒğš‘ğš ğššğšğš’ğšŒğš” ğš‹ğš›ğš˜ğš ğš— ğšğš˜ğš¡ ğš“ğšğš–ğš™ğšœ ğš˜ğšŸğšğš› ğšğš‘ğš ğš•ğšŠğš£ğš¢ ğšğš˜ğš", result: result::43 },
        { in: "â’¯â’£â’  â’¬â’°â’¤â’â’¦ â’â’­â’ªâ’²â’© â’¡â’ªâ’³ â’¥â’°â’¨â’«â’® â’ªâ’±â’ â’­ â’¯â’£â’  â’§â’œâ’µâ’´ â’Ÿâ’ªâ’¢", result: result::43 },
    ]
}

// null and missing propagation -----------------------------------------------------------------------------------
for::{
    template: [
        test::{
            name : "char_length null and missing propagation",
            sql : "char_length(${in})",
            expected : $result
        },

        test::{
            name : "character_length null and missing propagation",
            sql : "character_length(${in})",
            expected : $result
        }
    ],
    variableSets: [
        { in: "null", result: result::null },
        { in: "missing", result: result::null }
    ]
}

// wrong types ----------------------------------------------------------------------------------------------------
for::{
    template: [
        test::{
            name: "char_length wrong types",
            sql : "char_length(${in})",
            expected: error::{
                code: "null",
                properties: {
                    LINE_NUMBER:1,
                    COLUMN_NUMBER:1
                }
            }
        },

        test::{
            name: "character_length wrong types",
            sql : "character_length(${in})",
            expected: error::{
                code: "null",
                properties: {
                    LINE_NUMBER:1,
                    COLUMN_NUMBER:1
                }
            }
        }
    ],
    variableSets: [
        { in: "1" },
        { in: "`2000T`" },
        { in: "1.0" },
        { in: "1e0" },
        { in: "true" },
        { in: "[]" },
        { in: "`()`" },
        { in: "<<>>" },
        { in: "`{}`" },
    ]
}

// wrong number of arguments --------------------------------------------------------------------------------------
for::{
    template: [
        test::{
            name: "char_length wrong number of arguments",
            sql: "${sql}",
            expected: error::{
                code: EVALUATOR_INCORRECT_NUMBER_OF_ARGUMENTS_TO_FUNC_CALL,
                properties: {
                    LINE_NUMBER:1,
                    COLUMN_NUMBER:1,
                    EXPECTED_ARITY_MIN:1,
                    EXPECTED_ARITY_MAX:1
                }
            }
        }
    ],
    variableSets: [
        { sql: "char_length()" },
        { sql: '''char_length('', '')''' },
        { sql: '''char_length('', 1)''' },
    ]
}
